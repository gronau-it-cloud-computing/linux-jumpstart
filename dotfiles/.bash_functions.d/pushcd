cd()
{
	local dir=''

	case "$*" in
		'')		dir=~
				;;
		'~')	dir=~
				;;
		'-')	builtin pushd > /dev/null
				return $?
				;;
		*)		dir="$*"
				;;
	esac


	if [ "$PWD" == "$realhome" -o "$PWD" == "$HOME" ] ; then
		builtin cd "$dir"
	else
		builtin pushd "$dir" > /dev/null
	fi

	return $?
}

popd()
{
	if [ -z "$*" ] ; then
		if [ $(dirs -p | wc -l) -le 1 ] ; then
			builtin cd ~
			return $?
		fi
	fi

	builtin popd "$@"
	return $?
}
