# Sometimes you just want a plain old cd
bcd()
{
	builtin cd "$@"
}

cd_dash()
{
	local dir=''

	if [ "$OLDPWD" == "${DIRSTACK[1]}" ] ; then
		builtin pushd >/dev/null
		return $?
	fi

	builtin pushd "$OLDPWD" >/dev/null
}

# Make cd a function so that cding manipulates dirstack
cd()
{
	local dir=''

	# Determine where to cd to
	case "$1" in
		# cd with no args or the arg ~ should go HOME
		'')		dir="$HOME"
				;;
		'~')	dir="$HOME"
				;;
		'-')	cd_dash
				return $?
				;;
		# Special cases are covered, just pushd the argument
		*)		dir="$1"
				;;
	esac

	# If we're in HOME, don't put it on the stack; it just creates clutter
	if [ "$PWD" == "$HOME" ] ; then
		bcd "$dir"
	else
		builtin pushd "$dir" >/dev/null
	fi
}

# Add some nicities to popd
popd()
{
	# There are no arguments to popd
	if [ -z "$1" ] ; then
		# There's nothing to pop
		if [ "${#DIRSTACK[@]}" -lt 2 ] ; then
			# cd to HOME instead of complaining
			bcd "$HOME"
			return $?
		fi
	fi

	# I don't want this stack anymore
	if [ "$1" == '-c' ] ; then
		builtin dirs -c

		local dir=''
		# Did we get an additional argument?
		if [ -n "$2" ] ; then
			# Where do we want our new stack to start?
			dir="$2"
		else
			dir="$HOME"
		fi

		bcd "$dir"
		return $?
	fi

	# popd as normal
	builtin popd "$@"
}
